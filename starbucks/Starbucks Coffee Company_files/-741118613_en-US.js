jQuery.cookie=function(f,e,d){if(arguments.length>1&&String(e)!=="[object Object]"){d=jQuery.extend({},d);if(e===null||e===undefined){d.expires=-1}if(typeof d.expires==="number"){var b=d.expires,c=d.expires=new Date();c.setDate(c.getDate()+b)}e=String(e);return(document.cookie=[encodeURIComponent(f),"=",d.raw?e:encodeURIComponent(e),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join(""))}d=e||{};var g,a=d.raw?function(h){return h}:decodeURIComponent;return(g=new RegExp("(?:^|; )"+encodeURIComponent(f)+"=([^;]*)").exec(document.cookie))?a(g[1]):null};sb.namespace("Facebook");sb.Facebook=function(a,b){if(typeof b!="undefined"){this.authPath=(typeof b.authPath!="undefined")?b.authPath:"/connect/authorize";this.signoutPath=(typeof b.signoutPath!="undefined")?b.signoutPath:"/account/signout";this.statusPath=(typeof b.statusPath!="undefined")?b.statusPath:"/connect/status";this.connectPath=(typeof b.connectPath!="undefined")?b.connectPath:"/connect/connect";this.disconnectPath=(typeof b.disconnectPath!="undefined")?b.disconnectPath:"/connect/disconnect"}else{this.authPath="/connect/authorize";this.signoutPath="/account/signout";this.statusPath="/connect/status";this.connectPath="/connect/connect";this.disconnectPath="/connect/disconnect"}if(a){sb.Facebook.appidElId=a}this.scope="email";this.isLoaded=false};sb.Facebook.objetInstances=[];sb.Facebook.loadingData=false;sb.Facebook.enabled=false;sb.Facebook.prototype.init=function(c){if(!c&&!sb.Facebook.appidElId){sb.console.error("no appidElId provided.");return false}var b=this,g=null;var d=($("#"+c).length>0)?$("#"+c):$("#"+sb.Facebook.appidElId);g=(d.length>0)?d.attr("data-app-id"):null;if(!g){sb.console.error("no data-app-id or init called before document Ready");return false}sb.Facebook.enabled=(d.attr("fb_enabled")=="true")?true:false;window.fbAsyncInit=function(){FB.init({appId:g,cookie:true,status:true,xfbml:true,oauth:true});b.refreshInstances()};sb.Facebook.objetInstances.push(this);if(sb.Facebook.objetInstances.length==1){var e=sb.i18n.culture.toISOString("_");d.after('<div id="fb-root"></div>');var a={en_CA:"en_US"};e=a[e]||e;function h(k,j){var l=document.createElement("script");l.setAttribute("type","text/javascript");l.setAttribute("src",k);if(typeof j==="function"){l.onerror=j}l.onload=l.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){if(typeof j==="function"){j()}}};document.getElementsByTagName("head")[0].appendChild(l)}function f(){if(typeof FB==="undefined"&&e!=="en_US"){h("//connect.facebook.net/en_US/all.js")}}h("//connect.facebook.net/"+e+"/all.js",f)}};sb.Facebook.prototype.doLogIn=function(c,b){var a=this;if(!sb.Facebook.fbToken&&FB){sb.Facebook.fbToken=FB.getAccessToken()}function d(g,f){if(b){FB.login(function(h){g.apply(this,[h])},f)}else{g.apply(this,[{}])}}function e(f){f.apply(this,[true])}a.getStatus(function(f){if(f.auth==true&&f.perm==true){sb.console.info("FB: auth ok, perms ok");a.getFBUserData(function(g){e(function(h){c.apply(this,[{fb:true,sb:f}])})})}else{if(f.auth==true&&f.perm==false){sb.console.info("FB: auth ok, missing perms");d(function(g){if(g.authResponse){a.getFBUserData(function(h){e(function(j){c.apply(this,[{fb:false,sb:f}])})})}},{scope:a.scope})}else{sb.console.info("FB: no aut, no perms");d(function(g){a.getFBUserData(function(h){if(g.authResponse||b){if(h){e(function(j){c.apply(this,[{sb:f,fb:g}])})}}else{c.apply(this,[{sb:true,fb:g}])}})},{scope:a.scope})}}})};sb.Facebook.prototype.doLogOut=function(b){var a=this;FB.getLoginStatus(function(c){if(c.authResponse){FB.logout(function(d){$.get(a.signoutPath,{},function(e){if(!b){window.location.href="/account/signout"}}).error(function(f,e){if(!b){window.location.href="/account/signout"}})})}else{window.location.href="/account/signout"}})};sb.Facebook.prototype.getStatus=function(c){sb.Facebook.loadingData=true;var a=true,b=this;if(!sb.Facebook.fbToken&&FB){sb.Facebook.fbToken=FB.getAccessToken()}function d(e){b.getFBUserData(function(f){if(f){$.post(b.statusPath,{uId:sb.Facebook.fbUserData.uid,email:sb.Facebook.fbUserData.email,token:sb.Facebook.fbToken},function(g){e.apply(this,[g])},"json")}else{e.apply(this,[{isConnected:false,sbauth:false}])}})}FB.getLoginStatus(function(e){d(function(g){if(e.authResponse){var f=b.getScope();FB.Data.query("select "+f+" from permissions where uid="+e.authResponse.userID).wait(function(h){$.each(f.split(","),function(k,j){if(h[0][j]<1){a=false}});c.apply(this,[{auth:true,perm:a,isConnected:g.isConnected,isAuthenticated:g.isAuthenticated}])})}else{c.apply(this,[{auth:false,perm:false,isConnected:g.isConnected,isAuthenticated:g.sbauth}])}sb.Facebook.loadingData=false})})};sb.Facebook.prototype.getFBUserData=function(c,b){var a=this;if(!sb.Facebook.fbToken&&FB){sb.Facebook.fbToken=FB.getAccessToken()}if(sb.Facebook.fbUserData!=null&&!b){c.apply(this,[sb.Facebook.fbUserData]);return}FB.getLoginStatus(function(e){if(e.authResponse){var d=FB.Data.query("SELECT uid, first_name, last_name, name, email, pic_square_with_logo, profile_url FROM user WHERE uid = {0}",e.authResponse.userID);d.wait(function(f){sb.Facebook.fbUserData=f[0];c.apply(this,[sb.Facebook.fbUserData])})}else{c.apply(this,[null])}})};sb.Facebook.prototype.setScope=function(a){this.scope=a};sb.Facebook.prototype.getScope=function(){return this.scope};sb.Facebook.prototype.renderConfigs=function(){if(!sb.Facebook.fbToken&&FB){sb.Facebook.fbToken=FB.getAccessToken()}if(!sb.Facebook.fbUserData&&sb.Facebook.loadingData==false){sb.Facebook.loadingData=true;sb.Facebook.prototype.getFBUserData(function(){sb.Facebook.loadingData=false;if(sb.Facebook.fbUserData!=null){sb.console.info("initial FB data load")}})}return true};sb.Facebook.prototype.refreshInstances=function(){if(!sb.Facebook.fbToken&&FB){sb.Facebook.fbToken=FB.getAccessToken()}var a=sb.Facebook.objetInstances.length;for(i=0;i<a;i++){sb.Facebook.objetInstances[i].isLoaded=true;sb.Facebook.objetInstances[i].renderConfigs()}};sb.Facebook.prototype.linkAccounts=function(a){this.getFBUserData(function(b){if(b){$.post(this.connectPath,{uId:b.uid,email:b.email,token:sb.Facebook.fbToken},function(c){_gaq.push(["_trackEvent","account","Facebook","Link accounts"]);a.apply(this,[c.success])},"json")}else{a.apply(this,[{success:false}])}})};sb.Facebook.prototype.unLinkAccounts=function(a){this.getFBUserData(function(b){if(b){$.post(this.disconnectPath,{uId:b.uid,email:b.email},function(c){_gaq.push(["_trackEvent","account","Facebook","UnLink accounts"]);a.apply(this,[c.success])},"json")}else{a.apply(this,[{success:false}])}})};var fbGlobalInst=new sb.Facebook();var Cookies={init:function(){var c=document.cookie.split("; ");for(var b=0;b<c.length;b++){var a=c[b].split("=");this[a[0]]=a[1]}},create:function(c,e,a){if(a){var b=new Date();b.setTime(b.getTime()+(a*24*60*60*1000));var d="; expires="+b.toGMTString()}else{var d=""}document.cookie=c+"="+e+d+"; path=/";this[c]=e},erase:function(a){this.create(a,"",-1);this[a]=undefined}};Cookies.init();fbGlobalInst.renderConfigs=function(){sb.Facebook.prototype.renderConfigs.call(this);var a=this;fbGlobalInst.doLogIn(function(b){$.cookie("sbuxfbStatus",FB._userStatus);$.cookie("sbuxfbAccessToken",sb.Facebook.fbToken||FB.getAccessToken());if(b.sb.perm==true&&b.fb==true){$.cookie("sbuxfbConnected",b.sb.isConnected);$.cookie("sbuxfbStatus",FB._userStatus);a.getFBUserData(function(c){$.cookie("sbuxfb_first_name",c.first_name);$.cookie("sbuxfbid",c.uid);$.cookie("sbuxfbPicture",c.pic_square_with_logo);$.cookie("sbuxfbStatus",FB._userStatus)})}else{$.cookie("sbuxfb_first_name",null);$.cookie("sbuxfbid",null);$.cookie("sbuxfbAccessToken",null);$.cookie("sbuxfbPicture",null);$.cookie("sbuxfbConnected",null)}})};$(function(){fbGlobalInst.init("facebookGlobal");$(".fb_logout").on("click",function(a){fbGlobalInst.doLogOut();return false})});